"use strict";var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}function step(op){if(f)throw new TypeError("Generator is already executing.");while(g&&(g=0,op[0]&&(_=0)),_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}if(t[2])_.ops.pop();_.trys.pop();continue;}op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var cheerio_1=require("cheerio");var fetch_1=require("@libs/fetch");var novelStatus_1=require("@libs/novelStatus");var defaultCover_1=require("@libs/defaultCover");var LightNovelWPPlugin=(function(){function LightNovelWPPlugin(metadata){this.fetchImage=fetch_1.fetchFile;this.id=metadata.id;this.name=metadata.sourceName;this.icon="multisrc/lightnovelwp/".concat(metadata.id,".png");this.site=metadata.sourceSite;this.version="1.0.2";this.options=metadata.options;this.filters=metadata.filters;}LightNovelWPPlugin.prototype.getHostname=function(url){return url.split("/")[2];};LightNovelWPPlugin.prototype.getCheerio=function(url,search){return __awaiter(this,void 0,void 0,function(){var r,body,$,title;return __generator(this,function(_a){switch(_a.label){case 0:return[4,(0,fetch_1.fetchApi)(url)];case 1:r=_a.sent();if(!r.ok&&search!=true)throw new Error("You got banned ? (check in webview)");return[4,r.text()];case 2:body=_a.sent();$=(0,cheerio_1.load)(body);title=$("title").text().trim();if(this.getHostname(url)!=this.getHostname(r.url)||title=="Bot Verification"||title=="You are being redirected...")throw new Error("Captcha error, please open in webview");return[2,($)];}});});};LightNovelWPPlugin.prototype.parseNovels=function($){var _this=this;var novels=[];$("div.listupd > article").each(function(i,elem){var novelName=$(elem).find("h2").text();var image=$(elem).find("img");var novelUrl=$(elem).find("a").attr("href");if(novelUrl){novels.push({name:novelName,cover:image.attr("data-src")||image.attr("src")||defaultCover_1.defaultCover,path:novelUrl.replace(_this.site,""),});}});return novels;};LightNovelWPPlugin.prototype.popularNovels=function(pageNo,_a){var filters=_a.filters,showLatestNovels=_a.showLatestNovels;return __awaiter(this,void 0,void 0,function(){var url,key,_i,_b,value,$;return __generator(this,function(_c){switch(_c.label){case 0:url=this.site+"/series/?page="+pageNo;if(!filters)filters={};if(showLatestNovels)url+="&order=latest";for(key in filters){if(typeof filters[key].value==="object")for(_i=0,_b=filters[key].value;_i<_b.length;_i++){value=_b[_i];url+="&".concat(key,"=").concat(value);}else if(filters[key].value)url+="&".concat(key,"=").concat(filters[key].value);}return[4,this.getCheerio(url,false)];case 1:$=_c.sent();return[2,this.parseNovels($)];}});});};LightNovelWPPlugin.prototype.parseNovel=function(novelPath){var _a,_b;return __awaiter(this,void 0,void 0,function(){var $,novel,image,details,genres,summary,chapters;var _this=this;return __generator(this,function(_c){switch(_c.label){case 0:return[4,this.getCheerio(this.site+novelPath,false)];case 1:$=_c.sent();novel={path:novelPath.replace(this.site,""),name:"Untitled"};novel.name=$("h1.entry-title").text().trim();image=$("img.wp-post-image");novel.cover=image.attr("data-src")||image.attr("src")||defaultCover_1.defaultCover;switch(((_a=$("div.sertostat > span").attr("class"))===null||_a===void 0?void 0:_a.toLowerCase())||""){case"completed":novel.status=novelStatus_1.NovelStatus.Completed;break;case"ongoing":novel.status=novelStatus_1.NovelStatus.Ongoing;break;case"hiatus":novel.status=novelStatus_1.NovelStatus.OnHiatus;break;default:novel.status=novelStatus_1.NovelStatus.Unknown;break;}details=$("div.serl > span");if(!details.length)details=$("div.spe > span");details.each(function(){var detailName=$(this).contents().first().text().replace(":","").trim().toLowerCase();var detail=$(this).contents().last().text().trim().toLowerCase();switch(detailName){case"الكاتب":case"author":case"auteur":novel.author=detail;break;case"الحالة":case"status":switch(detail){case"مكتملة":case"completed":novel.status=novelStatus_1.NovelStatus.Completed;break;case"مستمرة":case"ongoing":novel.status=novelStatus_1.NovelStatus.Ongoing;break;case"متوقفة":case"hiatus":novel.status=novelStatus_1.NovelStatus.OnHiatus;break;default:novel.status=novelStatus_1.NovelStatus.Unknown;break;}break;case"الفنان":case"artist":case"artiste":novel.artist=detail;break;}});genres=$(".sertogenre");if(!genres.length)genres=$(".genxed");novel.genres=genres.children("a").map(function(i,el){return $(el).text();}).toArray().join(",");summary=$(".sersys > p").map(function(i,el){return $(el).text().trim();}).toArray();if(!summary.length)summary=$(".entry-content > p").map(function(i,el){return $(el).text().trim();}).toArray();novel.summary=summary.join("\n");chapters=[];$(".eplister li").each(function(i,elem){var chapterName=$(elem).find(".epl-num").text()+" "+$(elem).find(".epl-title").text();var chapterUrl=$(elem).find("a").attr("href")||"";var releaseTime=$(elem).find(".epl-date").text().trim();var isFreeChapter;switch($(elem).find(".epl-price").text().trim().toLowerCase()){case"free":case"gratuit":case"مجاني":case"":isFreeChapter=true;break;default:isFreeChapter=false;break;}if(isFreeChapter)chapters.push({name:chapterName,path:chapterUrl.replace(_this.site,""),releaseTime:releaseTime,});});if(((_b=this.options)===null||_b===void 0?void 0:_b.reverseChapters)&&chapters.length)chapters.reverse();novel.chapters=chapters;return[2,novel];}});});};LightNovelWPPlugin.prototype.parseChapter=function(chapterPath){var _a;return __awaiter(this,void 0,void 0,function(){var $,ignore;return __generator(this,function(_b){switch(_b.label){case 0:return[4,this.getCheerio(this.site+chapterPath,false)];case 1:$=_b.sent();if(this.id=="kolnovel"){ignore=$("article > style").text().trim().split(",");ignore.push.apply(ignore,(((_a=ignore.pop())===null||_a===void 0?void 0:_a.match(/^\.\w+/))||[]));ignore.map(function(tag){return $("p".concat(tag)).remove();});}return[2,$(".epcontent p").map(function(i,el){return $(el);}).toArray().join("\n")||""];}});});};LightNovelWPPlugin.prototype.searchNovels=function(searchTerm,page){return __awaiter(this,void 0,void 0,function(){var url,$;return __generator(this,function(_a){switch(_a.label){case 0:url=this.site+"page/"+page+"/?s="+searchTerm;return[4,this.getCheerio(url,true)];case 1:$=_a.sent();return[2,this.parseNovels($)];}});});};return LightNovelWPPlugin;}());var plugin=new LightNovelWPPlugin({"id":"allnovelread","sourceSite":"https://allnovelread.com/","sourceName":"AllNovelRead","options":{"lang":"Spanish","reverseChapters":true},"filters":{"genre[]":{"type":"Checkbox","label":"Genre","value":[],"options":[{"label":"16+","value":"16"},{"label":"Abogado/Abogada","value":"abogado-abogada"},{"label":"Action","value":"action"},{"label":"Advogdo","value":"advogdo"},{"label":"affair of the heart","value":"affair-of-the-heart"},{"label":"alfa","value":"alfa"},{"label":"Alpha","value":"alpha"},{"label":"Amable","value":"amable"},{"label":"Amar","value":"amar"},{"label":"Amor","value":"amor"},{"label":"Amor caliente","value":"amor-caliente"},{"label":"amor depois do casamento","value":"amor-depois-do-casamento"},{"label":"Amor después del matrimonio","value":"amor-despues-del-matrimonio"},{"label":"Amor destinado","value":"amor-destinado"},{"label":"Amor doloroso","value":"amor-doloroso"},{"label":"Amor dulce","value":"amor-dulce"},{"label":"Amor e ódio","value":"amor-e-odio"},{"label":"Amor e ódio Gravidez","value":"amor-e-odio-gravidez"},{"label":"amor entre ex","value":"amor-entre-ex"},{"label":"Amor forzado","value":"amor-forzado"},{"label":"Amor Inocente","value":"amor-inocente"},{"label":"amor predestinado","value":"amor-predestinado"},{"label":"Amor y odio","value":"amor-y-odio"},{"label":"arrepentirse del divorcio","value":"arrepentirse-del-divorcio"},{"label":"Arrepentirse Después de Herir a Su Mujer","value":"arrepentirse-despues-de-herir-a-su-mujer"},{"label":"Arrogante","value":"arrogante"},{"label":"Asesinato","value":"asesinato"},{"label":"Babby","value":"babby"},{"label":"BABY","value":"baby"},{"label":"Beauty","value":"beauty"},{"label":"Bebê fofo","value":"bebe-fofo"},{"label":"Bebé inteligente","value":"bebe-inteligente"},{"label":"belleza","value":"belleza"},{"label":"Belleza inusual","value":"belleza-inusual"},{"label":"Bilionário","value":"bilionario"},{"label":"Billionair","value":"billionair"},{"label":"billionaire","value":"billionaire"},{"label":"Billonario/Billonaria","value":"billonario-billonaria"},{"label":"brilliant","value":"brilliant"},{"label":"bxg","value":"bxg"},{"label":"Bxg-novela","value":"bxg-novela"},{"label":"Campus","value":"campus"},{"label":"Casamiento","value":"casamiento"},{"label":"CEO","value":"ceo"},{"label":"city","value":"city"},{"label":"Colegiala","value":"colegiala"},{"label":"Comedia","value":"comedia"},{"label":"Comedia-novela","value":"comedia-novela"},{"label":"Comedy","value":"comedy"},{"label":"contemporáneo","value":"contemporaneo"},{"label":"Contract marriage","value":"contract-marriage"},{"label":"cónyuge","value":"conyuge"},{"label":"Corazón roto","value":"corazon-roto"},{"label":"courtship","value":"courtship"},{"label":"Crecimiento del personaje","value":"crecimiento-del-personaje"},{"label":"Crimen organizado","value":"crimen-organizado"},{"label":"Critical","value":"critical"},{"label":"cruel","value":"cruel"},{"label":"De pobre a rico","value":"de-pobre-a-rico"},{"label":"Divertido","value":"divertido"},{"label":"Divorce","value":"divorce"},{"label":"Divorcio","value":"divorcio"},{"label":"Doce","value":"doce"},{"label":"Doctor","value":"doctor"},{"label":"Dominador","value":"dominador"},{"label":"Dominante","value":"dominante"},{"label":"Dominante-novela","value":"dominante-novela"},{"label":"drama","value":"drama"},{"label":"dulce","value":"dulce"},{"label":"Dulce Embarazada","value":"dulce-embarazada"},{"label":"elegante","value":"elegante"},{"label":"Embarazada","value":"embarazada"},{"label":"En la actualidad","value":"en-la-actualidad"},{"label":"Enemigos a los amantes","value":"enemigos-a-los-amantes"},{"label":"existente","value":"existente"},{"label":"Family","value":"family"},{"label":"Fantasy","value":"fantasy"},{"label":"Fated","value":"fated"},{"label":"Fraco para forte/Pob","value":"fraco-para-forte-pob"},{"label":"fuerte","value":"fuerte"},{"label":"Goodgirl","value":"goodgirl"},{"label":"Gravidez","value":"gravidez"},{"label":"HE","value":"he"},{"label":"heir/heiress","value":"heir-heiress"},{"label":"hermoso","value":"hermoso"},{"label":"Héroe pateador","value":"heroe-pateador"},{"label":"Heroina","value":"heroina"},{"label":"heroína Kickass","value":"heroina-kickass"},{"label":"heterose*ual","value":"heteroseual"},{"label":"historia de amor","value":"historia-de-amor"},{"label":"Hot Romance","value":"hot-romance"},{"label":"Humor","value":"humor"},{"label":"Identidad secreta","value":"identidad-secreta"},{"label":"Independente","value":"independente"},{"label":"Independiente","value":"independiente"},{"label":"Inocente","value":"inocente"},{"label":"jefe","value":"jefe"},{"label":"Jefe / CEO","value":"jefe-ceo"},{"label":"kicking","value":"kicking"},{"label":"king","value":"king"},{"label":"legend","value":"legend"},{"label":"Literature","value":"literature"},{"label":"loser","value":"loser"},{"label":"Love","value":"love"},{"label":"Love & Culture","value":"love-culture"},{"label":"love after marriage","value":"love-after-marriage"},{"label":"love story","value":"love-story"},{"label":"LOVEAFTERMARRIAGE","value":"loveaftermarriage"},{"label":"lucky dog","value":"lucky-dog"},{"label":"Lugar para você Allnovelread","value":"lugar-para-voce-allnovelread"},{"label":"luna","value":"luna"},{"label":"Madre soltera","value":"madre-soltera"},{"label":"Mafia","value":"mafia"},{"label":"magical world","value":"magical-world"},{"label":"Malentendido","value":"malentendido"},{"label":"Maquinación","value":"maquinacion"},{"label":"Marriage","value":"marriage"},{"label":"Matrimonio","value":"matrimonio"},{"label":"Matrimonio por Contrato","value":"matrimonio-por-contrato"},{"label":"Matrimonio relámpago","value":"matrimonio-relampago"},{"label":"Medico","value":"medico"},{"label":"Médico/Médica","value":"medico-medica"},{"label":"millonaria","value":"millonaria"},{"label":"modificación","value":"modificacion"},{"label":"most millions","value":"most-millions"},{"label":"Mucama","value":"mucama"},{"label":"Mujer súper poderosa","value":"mujer-super-poderosa"},{"label":"Multi-Millionairo","value":"multi-millionairo"},{"label":"Multimillionairo","value":"multimillionairo"},{"label":"Multimillonaria","value":"multimillonaria"},{"label":"multimillonario","value":"multimillonario"},{"label":"Multimillonario-novela","value":"multimillonario-novela"},{"label":"MULTIPLEIDENTITIES","value":"multipleidentities"},{"label":"Múltiples identidades","value":"multiples-identidades"},{"label":"musculoso","value":"musculoso"},{"label":"Nacimiento múltiple","value":"nacimiento-multiple"},{"label":"Novia embarazada a la fuga","value":"novia-embarazada-a-la-fuga"},{"label":"Obsesión","value":"obsesion"},{"label":"Ocultar","value":"ocultar"},{"label":"Optimista","value":"optimista"},{"label":"others","value":"others"},{"label":"Pasión de una noche","value":"pasion-de-una-noche"},{"label":"Perao/Segunda chance","value":"perao-segunda-chance"},{"label":"Perdedor","value":"perdedor"},{"label":"Playboy","value":"playboy"},{"label":"poderoso","value":"poderoso"},{"label":"polygamy","value":"polygamy"},{"label":"Posesivo","value":"posesivo"},{"label":"possessive","value":"possessive"},{"label":"Possessivo","value":"possessivo"},{"label":"Powerful","value":"powerful"},{"label":"presente","value":"presente"},{"label":"Presidente","value":"presidente"},{"label":"princess","value":"princess"},{"label":"Protective","value":"protective"},{"label":"Protectormadre soltera","value":"protectormadre-soltera"},{"label":"Reconquistar a mi pareja","value":"reconquistar-a-mi-pareja"},{"label":"rejected","value":"rejected"},{"label":"relación","value":"relacion"},{"label":"relationship","value":"relationship"},{"label":"Renacido","value":"renacido"},{"label":"Rey/Reina","value":"rey-reina"},{"label":"Rich","value":"rich"},{"label":"Rico","value":"rico"},{"label":"Ricos","value":"ricos"},{"label":"Romance","value":"romance"},{"label":"romance caliente","value":"romance-caliente"},{"label":"Romance/Romântico","value":"romance-romantico"},{"label":"Romántic","value":"romantic"},{"label":"Romantica","value":"romantica"},{"label":"Romanticas","value":"romanticas"},{"label":"Romantico","value":"romantico"},{"label":"Secretos","value":"secretos"},{"label":"secrets","value":"secrets"},{"label":"seductive","value":"seductive"},{"label":"Segunda Chance","value":"segunda-chance"},{"label":"Segunda oportunidad","value":"segunda-oportunidad"},{"label":"STRONGFEMALELEAD","value":"strongfemalelead"},{"label":"Subrogación","value":"subrogacion"},{"label":"Suspense","value":"suspense"},{"label":"Sweet","value":"sweet"},{"label":"SWEETLOVE","value":"sweetlove"},{"label":"Teenager","value":"teenager"},{"label":"Tierno","value":"tierno"},{"label":"Tragedia","value":"tragedia"},{"label":"Traición","value":"traicion"},{"label":"TraiciónReconquistar a mi pareja","value":"traicionreconquistar-a-mi-pareja"},{"label":"Triángulo amoroso","value":"triangulo-amoroso"},{"label":"Trillizos","value":"trillizos"},{"label":"Trio","value":"trio"},{"label":"Una noche de pasion","value":"una-noche-de-pasion"},{"label":"Universidad","value":"universidad"},{"label":"Valente","value":"valente"},{"label":"Valiente","value":"valiente"},{"label":"Venanza","value":"venanza"},{"label":"Werewolf","value":"werewolf"},{"label":"Ya","value":"ya"},{"label":"Youth","value":"youth"}]},"type[]":{"type":"Checkbox","label":"Type","value":[],"options":[{"label":"16+","value":"16"},{"label":"alfa","value":"alfa"},{"label":"Allnovelread Sin vuelta atrás","value":"allnovelread-sin-vuelta-atras"},{"label":"Alpha","value":"alpha"},{"label":"Amor dulce","value":"amor-dulce"},{"label":"Amor y odio","value":"amor-y-odio"},{"label":"Arrogante-novela","value":"arrogante-novela"},{"label":"Billionaire","value":"billionaire"},{"label":"Billonario","value":"billonario"},{"label":"bxg","value":"bxg"},{"label":"CEO","value":"ceo"},{"label":"Contemporâneo","value":"contemporaneo"},{"label":"Contract marriage","value":"contract-marriage"},{"label":"crecimiento-del-personaje-novela","value":"crecimiento-del-personaje-novela"},{"label":"Divorce","value":"divorce"},{"label":"drama","value":"drama"},{"label":"dulce","value":"dulce"},{"label":"El incesante acoso de mi ex marido","value":"el-incesante-acoso-de-mi-ex-marido"},{"label":"Enganar al mejor amigo de mi novio","value":"enganar-al-mejor-amigo-de-mi-novio"},{"label":"Fantasy","value":"fantasy"},{"label":"HE","value":"he"},{"label":"heterosexual","value":"heterosexual"},{"label":"Historia-triste-novela","value":"historia-triste-novela"},{"label":"Hombre lobo","value":"hombre-lobo"},{"label":"Hot Romance","value":"hot-romance"},{"label":"Independiente","value":"independiente"},{"label":"Inocente","value":"inocente"},{"label":"king","value":"king"},{"label":"Love","value":"love"},{"label":"love after marriage","value":"love-after-marriage"},{"label":"Luna","value":"luna"},{"label":"Magical world","value":"magical-world"},{"label":"millonaria","value":"millonaria"},{"label":"Multi-Millionaire","value":"multi-millionaire"},{"label":"Multimillionairo","value":"multimillionairo"},{"label":"Multimillonario","value":"multimillonario"},{"label":"Nunca Longe Allnovelread","value":"nunca-longe-allnovelread"},{"label":"Posesivo","value":"posesivo"},{"label":"Querida ex esposa","value":"querida-ex-esposa"},{"label":"Romance","value":"romance"},{"label":"Romane","value":"romane"},{"label":"Romántica","value":"romantica"},{"label":"Romanticas","value":"romanticas"},{"label":"Romantico","value":"romantico"},{"label":"Sweet","value":"sweet"},{"label":"SWEETLOVE","value":"sweetlove"},{"label":"Te Quero de Volta Allnovelread","value":"te-quero-de-volta-allnovelread"},{"label":"Traicion en altar","value":"traicion-en-altar"},{"label":"Uma Ferida Que Nunca Se Cura Allnovelread","value":"uma-ferida-que-nunca-se-cura-allnovelread"},{"label":"Urban","value":"urban"},{"label":"Urban/Realistic","value":"urban-realistic"},{"label":"vuelva a mí","value":"vuelva-a-mi"},{"label":"Werewolf","value":"werewolf"}]},"status":{"type":"Picker","label":"Status","value":"","options":[{"label":"All","value":""},{"label":"Ongoing","value":"ongoing"},{"label":"Hiatus","value":"hiatus"},{"label":"Completed","value":"completed"}]},"order":{"type":"Picker","label":"Order by","value":"","options":[{"label":"Default","value":""},{"label":"A-Z","value":"title"},{"label":"Z-A","value":"titlereverse"},{"label":"Latest Update","value":"update"},{"label":"Latest Added","value":"latest"},{"label":"Popular","value":"popular"}]}}});exports.default=plugin;